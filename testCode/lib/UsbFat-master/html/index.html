<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>UsbFat: Arduino UsbFat Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">UsbFat
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Arduino UsbFat Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><center>Copyright &copy; 2014 by William Greiman </center><h1><a class="anchor" id="Intro"></a>
Introduction</h1>
<p>The Arduino UsbFat Library is a minimal implementation of FAT16 and FAT32 file systems on USB flash drives and USB hard drives.</p>
<p>Experimental support for FAT12 can be enabled by setting FAT12_SUPPORT nonzero in <a class="el" href="_usb_fat_config_8h.html" title="configuration definitions ">UsbFatConfig.h</a>.</p>
<p>The UsbFat library supports Long File Names or short 8.3 names. Edit the <a class="el" href="_usb_fat_config_8h.html" title="configuration definitions ">UsbFatConfig.h</a> file to select short or long file names.</p>
<p>The main classes in UsbFat are <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a>, <a class="el" href="class_fat_file.html" title="Basic file class. ">FatFile</a>, <a class="el" href="class_print_file.html" title="FatFile with Print. ">PrintFile</a>, <a class="el" href="class_file.html" title="Arduino SD.h style File API. ">File</a>, <a class="el" href="class_stdio_stream.html" title="StdioStream implements a minimal stdio stream. ">StdioStream</a>, <a class="el" href="classfstream.html">fstream</a>, <a class="el" href="classifstream.html">ifstream</a>, and <a class="el" href="classofstream.html">ofstream</a>.</p>
<p>The <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> class maintains a FAT volume, a current working directory, and simplifies initialization of other classes.</p>
<p>The <a class="el" href="class_fat_file.html" title="Basic file class. ">FatFile</a> class provides basic file access functions such as open(), binary read(), binary write(), close(), remove(), and sync(). <a class="el" href="class_fat_file.html" title="Basic file class. ">FatFile</a> is the smallest file class.</p>
<p>The <a class="el" href="class_print_file.html" title="FatFile with Print. ">PrintFile</a> class has all the <a class="el" href="class_fat_file.html" title="Basic file class. ">FatFile</a> class functions plus the Arduino Print class functions.</p>
<p>The <a class="el" href="class_file.html" title="Arduino SD.h style File API. ">File</a> class has all the <a class="el" href="class_fat_file.html" title="Basic file class. ">FatFile</a> functions plus the functions in the Arduino SD.h <a class="el" href="class_file.html" title="Arduino SD.h style File API. ">File</a> class. This provides compatibility with the Arduino SD.h library.</p>
<p>The <a class="el" href="class_stdio_stream.html" title="StdioStream implements a minimal stdio stream. ">StdioStream</a> class implements functions similar to Linux/Unix standard buffered input/output.</p>
<p>The <a class="el" href="classfstream.html">fstream</a> class implements C++ iostreams for both reading and writing text files.</p>
<p>The <a class="el" href="classifstream.html">ifstream</a> class implements C++ iostreams for reading text files.</p>
<p>The <a class="el" href="classofstream.html">ofstream</a> class implements C++ iostreams for writing text files.</p>
<p>The classes <a class="el" href="classifstream.html">ifstream</a>, <a class="el" href="classofstream.html">ofstream</a>, <a class="el" href="classistream.html">istream</a>, and <a class="el" href="classostream.html">ostream</a> follow the C++ <a class="el" href="classiostream.html">iostream</a> standard when possible.</p>
<p>There are many tutorials and much documentation about using C++ iostreams on the web.</p>
<p><a href="http://www.cplusplus.com/">http://www.cplusplus.com/</a> is a good C++ site for learning iostreams.</p>
<p>The classes <a class="el" href="classibufstream.html">ibufstream</a> and <a class="el" href="classobufstream.html">obufstream</a> format and parse character strings in memory buffers.</p>
<p>the classes <a class="el" href="class_arduino_in_stream.html" title="Input stream for Arduino Stream objects. ">ArduinoInStream</a> and <a class="el" href="class_arduino_out_stream.html" title="Output stream for Arduino Print objects. ">ArduinoOutStream</a> provide iostream functions for Serial, LiquidCrystal, and other devices.</p>
<p>Several of example are provided in the UsbFat/examples folder. These were developed to test UsbFat and illustrate its use.</p>
<h1><a class="anchor" id="Install"></a>
Installation</h1>
<p>You must manually install <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> by copying the <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> folder from the download package to the Arduino libraries folder in you sketch folder.</p>
<p>See the Manual installation section of this guide.</p>
<p><a href="http://arduino.cc/en/Guide/Libraries">http://arduino.cc/en/Guide/Libraries</a></p>
<p>The Circuits@Home USB_Host_Shield_2.0 library must also be installed in your libraries folder. A modified version of this library is included with <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a>. The modifications reduce the time to initialize most USB drives.</p>
<p>Place the USB_Host_Shield_2.0 folder in your Arduino libraries folder.</p>
<p>The unmodified version is here:</p>
<p><a href="https://github.com/felis/USB_Host_Shield_2.0">https://github.com/felis/USB_Host_Shield_2.0</a></p>
<h1><a class="anchor" id="Fatconfig"></a>
UsbFat Configuration</h1>
<p>Several configuration options may be changed by editing the <a class="el" href="_usb_fat_config_8h.html" title="configuration definitions ">UsbFatConfig.h</a> file in the UsbFat folder.</p>
<p>Set USE_LONG_FILE_NAMES nonzero to enable Long File Names. By default, Long File Names are enabled. For the leanest fastest library disable Long File Names. Long File names require extra flash but no extra RAM. Opening Long File Names can be slower than opening Short File Names. Data read and write performance is not changed by the type of File Name.</p>
<p>Set FAT12_SUPPORT nonzero to enable use of FAT12 volumes. FAT12 has not been well tested and requires additional flash.</p>
<h1><a class="anchor" id="FatPath"></a>
Paths and Working Directories</h1>
<p>Relative paths in <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> are resolved in a manner similar to Windows.</p>
<p>Each instance of <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> has a current directory. In <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> this directory is called the volume working directory, vwd. Initially this directory is the root directory for the volume.</p>
<p>The volume working directory is changed by calling UsbFat::chdir(path).</p>
<p>The call key.chdir("/2014") will change the volume working directory for key to "/2014", assuming "/2014" exists.</p>
<p>Relative paths for <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> member functions are resolved by starting at the volume working directory.</p>
<p>For example, the call key.mkdir("April") will create the directory "/2014/April" assuming the volume working directory is "/2014".</p>
<p><a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> has a current working directory, cwd, that is used to resolve paths for file.open() calls.</p>
<p>For a single volume the current working directory is always the volume working directory.</p>
<p>For multiple volumes the current working directory is set to the volume working directory of a card by calling the <a class="el" href="class_fat_file_system.html#af24917d6e00c8766dab168eb834047ec">UsbFat::chvol()</a> member function. The chvol() call is like the Windows &lt;drive letter&gt;: command.</p>
<p>The call key2.chvol() will set the current working directory to the volume working directory for key2.</p>
<p>If the volume working directory for key2 is "/music" the call</p>
<p>file.open("BigBand.wav", O_READ);</p>
<p>will then open "/music/BigBand.wav" on key2.</p>
<p>The following functions are used to change or get current directories. See the html documentation for more information. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="class_fat_file_system.html#a5667915e63187a43a71dfada63800865">UsbFat::chdir</a>(<span class="keywordtype">bool</span> set_cwd = <span class="keyword">false</span>);</div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="class_fat_file_system.html#a5667915e63187a43a71dfada63800865">UsbFat::chdir</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, <span class="keywordtype">bool</span> set_cwd = <span class="keyword">false</span>);</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="class_fat_file_system.html#af24917d6e00c8766dab168eb834047ec">UsbFat::chvol</a>();</div>
<div class="line"><a class="code" href="class_fat_file.html">FatFile</a>* <a class="code" href="class_fat_file_system.html#acf257d02b7166683bda2abc5058004bf">UsbFat::vwd</a>();</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="class_fat_file.html">FatFile</a>* <a class="code" href="class_fat_file.html#a3b68e603ad8e47bad915f0547e580adb">FatFile::cwd</a>();</div>
</div><!-- fragment --><h1><a class="anchor" id="Hardware"></a>
Hardware Configuration</h1>
<p>UsbFat was developed using an <a href="http://www.circuitsathome.com/products-page/arduino-shields">Circuits@Home</a> Host Shield. Testing was also done using an <a href="http://arduino.cc/en/Main/ArduinoBoardMegaADK">Mega ADK</a>.</p>
<h1><a class="anchor" id="comment"></a>
Bugs and Comments</h1>
<p>If you wish to report bugs or have comments, send email to <a href="#" onclick="location.href='mai'+'lto:'+'fat'+'16'+'lib'+'@s'+'bcg'+'lo'+'bal'+'.n'+'et'; return false;">fat16<span style="display: none;">.nosp@m.</span>lib@<span style="display: none;">.nosp@m.</span>sbcgl<span style="display: none;">.nosp@m.</span>obal<span style="display: none;">.nosp@m.</span>.net</a>. If possible, include a simple program that illustrates the bug or problem.</p>
<h1><a class="anchor" id="Trouble"></a>
Troubleshooting</h1>
<p>Try enabling extra debug messages by setting USB_FAT_DBG_MODE nonzero in <a class="el" href="_usb_fat_config_8h.html" title="configuration definitions ">UsbFatConfig.h</a>.</p>
<p>Also run the UsbFatInfo example.</p>
<p>Additional diagnostic tools will be provided in the future.</p>
<h1><a class="anchor" id="UsbFatClass"></a>
UsbFat Usage</h1>
<p><a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> supports Long <a class="el" href="class_file.html" title="Arduino SD.h style File API. ">File</a> Names. Long names in <a class="el" href="class_usb_fat.html" title="FAT file systems on USB flash drives and USB hard drives. ">UsbFat</a> are limited to 7-bit ASCII characters in the range 0X20 - 0XFE The following are reserved characters: </p><ul>
<li>
&lt; (less than) </li>
<li>
&gt; (greater than) </li>
<li>
: (colon) </li>
<li>
" (double quote) </li>
<li>
/ (forward slash) </li>
<li>
\ (backslash) </li>
<li>
| (vertical bar or pipe) </li>
<li>
? (question mark) </li>
<li>
* (asterisk) </li>
</ul>
<p>UsbFat uses a slightly restricted form of short names. Short names are limited to 8 characters followed by an optional period (.) and extension of up to 3 characters. The characters may be any combination of letters and digits. The following special characters are also allowed:</p>
<p>$ % ' - _ @ ~ ` ! ( ) { } ^ # &amp;</p>
<p>Short names are always converted to upper case and their original case value is lost. Files that have a base-name where all characters have the same case and an extension where all characters have the same case will display properly. Examples this type name are UPPER.low, lower.TXT, UPPER.TXT, and lower.txt.</p>
<p>An application which writes to a file using print(), println() or <a class="el" href="class_print_file.html#a460b033ff85e85f684f8d9b615645db1">write() </a> must close the file or call <a class="el" href="class_fat_file.html#a67f3dc4896c542d695e11aac927f585e">sync() </a> at the appropriate time to force data and directory information to be written to the drive.</p>
<p>Applications must use care calling <a class="el" href="class_fat_file.html#a67f3dc4896c542d695e11aac927f585e">sync() </a> since 2048 bytes of I/O is required to update file and directory information. This includes writing the current data block, reading the block that contains the directory entry for update, writing the directory block back and reading back the current data block.</p>
<p>It is possible to open a file with two or more instances of a file object. A file may be corrupted if data is written to the file by more than one instance of a file object.</p>
<h1><a class="anchor" id="HowTo"></a>
How to format USB drives as FAT Volumes</h1>
<p>A special utility is required to format hard drives on Windows. Windows does not allow hard drives larger than 32 GB to be formatted FAT32. I have used this formatter.</p>
<p><a href="http://www.ridgecrop.demon.co.uk/index.htm?guiformat.htm">http://www.ridgecrop.demon.co.uk/index.htm?guiformat.htm</a></p>
<p>For USB flash drives, many people use the HP USB Disk Storage Format Tool. I have used versions of this tool but have not done detailed tests.</p>
<p>Many manufactures have software for their USB flash drives.</p>
<p><a href="http://www.flashdrive-repair.com/2014/02/best-usb-flash-drive-repair-software-recovery-format.html">http://www.flashdrive-repair.com/2014/02/best-usb-flash-drive-repair-software-recovery-format.html</a></p>
<p>For best performance, format drives with a large cluster size. Format 2 GB and smaller drives FAT16. Drives larger than 2 GB should be formatted FAT32 with a cluster size of at least 8 KB or larger.</p>
<p>You should use a freshly formatted drive for best performance. FAT file systems become slower if many files have been created and deleted. This is because the directory entry for a deleted file is marked as deleted, but is not deleted. When a new file is created, these entries must be scanned before creating the file. Also files can become fragmented which causes reads and writes to be slower.</p>
<h1><a class="anchor" id="ExampleFolder"></a>
Examples</h1>
<p>Several examples are provided in the UsbFat/examples folder. See the html documentation for a list.</p>
<p>To access these examples from the Arduino development environment go to: File -&gt; Examples -&gt; UsbFat -&gt; &lt;program Name&gt;</p>
<p>Compile, upload to your Arduino and click on Serial Monitor to run the example.</p>
<p>Here is a list:</p>
<p>UsbDriveInfo - Determine properties of a USB drive.</p>
<p>UsbFatBench - A read/write benchmark.</p>
<p>UsbFatDemo - A simple Demo program.</p>
<p>UsbLogger - A simple modifiable data logger. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Dec 20 2014 10:55:08 for UsbFat by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
